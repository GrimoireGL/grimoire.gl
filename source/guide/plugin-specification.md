---
Type: doc
Title: plugin specification
Order: 3
---

In grimoire.js, plugins can be used to increase the number of newly usable tags for users, and to extend the interface.
To increase these plugins and to accumulate various tag-based functions reusable by anyone on the Web, each plugin needs to satisfy the following specifications.

We provide a package to provide templates to satisfy these functions, but if you use your own build environment you must consider the following specifications.

# Folder structure

When publishing a plug-in to npm, the following two folders are always included.

* Ref
* Register

# file organization

## register/index.js

It is a file that is read when the user of the plugin reads `require (" plugin name/register ")`. This javascript file should be output with all the files in the plugin bundled.

Also, export of this file has specification to output the following object.

For example, let's assume that a plugin has the following file.

* Src/A. js
* Src/B/C. js
* Src/B/D.js

If you have such a file, index.js must export the following objects:

```javascript
{
  A: require ("./A. js"),
  B: {
    C: require ("./B.js"),
    D: require ("./C. js")
  }
}
```

Also, at the same time it is necessary to assign the above object itself output when this code is called to `window.GrimoireJS.lib. {{Library name}}`.

**important point**

* The bundled file should not include the dependent Grimoire.js plugin.
(Do not call `require (" Destination library name/register ")` in the plugin. `` Require ("Destination library name/ref/PATH/TO/MODULE") `is a reference so it should not be a problem.
* In the source folder, folder A and file A. js should not exist at the same time. (In this case, the above index.js can not be generated successfully.)

## ref Folder

A file for acquiring a reference to each source file without plug-in is included.

For example, `src/B/C. js` generates` ref/B/C. js` which exports the following contents.

```javascript
Window.GrimoireJS.lib. {{Library name}}. B.C;
```

Also, in order to consider the user who accesses the library using Typescript, one of the following two files is set to `ref/B/Cdts` for` src/B/C. js` It is necessary to generate it.

** When src/B/C.ts exists (when the plugin itself is written in Typescript) **

A `d.ts` file (using a type declaration file) generated when` src/B/C. ts` of the library is compiled

** When src/B/C.ts does not exist (when the plugin itself is not described in Typescript) **

Generate the following `d.ts` file respectively.

```typescript
Var v: any;
Export default v;
```

## ref/index.js

You need to export the following objects.

```javascript
Window.GrimoireJS.lib. {{Library name}};
```

# Grimoirejs-cauldron helper command

The `grimoirejs-cauldron` package contains several autogenerated commands to satisfy the above specifications.

## generate-exposure command

```bash
$ Cauldron generate-exposure --src ./src --dest ./src/index.ts --ts - main./src/main.ts
```

| Parameter name | Description |
|: -: |: -:: |
| Src | Folder containing the file to be referenced (the file used by the plugin)
| Dest | Generate js file (ts file for typescript) |
| Ts | Whether to generate typescript |
| Main | File to be called in plugin registration processing (plugin entry point) |

## generate-reference Command

```bash
$ Cauldron generate-reference --src ./src --dest ./src/index.ts --ts --main ./src/main.ts --dts ./ref
```

| Parameter name | Description |
|: -: |: -:: |
| Src | Folder containing the file to be referenced (the file used by the plugin)
| Dest | Generate js file (ts file for typescript) |
| Ts | Whether to generate typescript |
| Main | File to be called in plugin registration processing (plugin entry point) |
| Dts | dts Where to create the folder (basically ref folder) |

# Babel's Polyfill Points of Remembrance

All js files in ref and register must be babel followed by es 2015 compliant code. However, since you are having trouble putting `babel-polyfill` in each plugin, you should not use` require ("babel-polyfill") `or` transform-runtime` plug-ins with the following exceptions .

## preset

In Grimoire.js, you can install multiple sets of plugins as presets and use them as script tags like preset in babel settings.
If you use preset that includes `grimoirejs` in this preset, you need to use` babel-polyfill` only for the script tag. (** register/index.js is a file used when required and should not be included in this **)

Also, considering that other plugins can be used to read from script, plugins should not be bundled with the `transform-runtime` plugin.
