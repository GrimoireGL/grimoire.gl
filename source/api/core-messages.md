---
type: doc
title: コアメッセージ
order: 1
---

すべてのメッセージは`$`から始まるメソッドによってハンドリングされます。
これは、通常のメソッドとして作成したつもりのコンポーネントないのメソッドが別のコンポーネントが発行するメッセージによって起動してしまうことによるバグなどを抑制するためです。

## GrimoireJS自身が定義するメッセージ群

### awake

定義

```typescript

function $awake():void;

```

あるコンポーネントがインスタンス化された際、自動的に呼び出されます。
コンストラクタとは異なり、これが呼び出される際は以下のプロパティーがコンポーネントのインスタンスいん挿入されていることが保障されます。

* node(親ノード)
* name(自身のコンポーネント名)
* attributes(属性群)
* sharedObject(親ノードがツリーにアタッチされている場合のみ(それ以外はnull))

### treeInitialized

```typescript
  function $treeInitialized(c: ITreeInitializedInfo): void;
```

```typescript
interface ITreeInitializedInfo {
    ownerScriptTag: HTMLScriptElement; // このGOMLを含んでいるスクリプトタグ
    id: string; // 各ツリーに割り振られたユニークなID
}
```

ツリーが初期化された際に呼び出されます。
初期のGOMLの中に記述されているノードが全て初期化されると呼び出されます。

初期化後に追加されたいかなるコンポーネントには呼び出されることはありません。

### mount

```typescript
  function $mount():void;
```

コンポーネントが属するノードがツリーに結びついた際に呼び出されます。

### unmount

```typescript
  function $unmount():void;
```

コンポーネントが属しているノードがツリーからデタッチされた際に呼び出されます。


## 初期化時のアルゴリズム

あるノードNが親ノードPに属するように新たにノードNをインスタンス化する際、以下のような順序で初期化されることが想定されている。
```
// コンポーネントの初期化処理
1. Nをインスタンス化
2. FOR c <= すべてのNの必須コンポーネント
2-1. cをインスタンス化
2-2. FOR a <= すべてのcの属性
2-2-1. aをインスタンス化してcにセット

3. c <= すべてのNの追加コンポーネント(GOMLないで.COMPONENTSにより指定されたコンポーネント)
3-1. cをインスタンス化
3-2. FOR a <= すべてのcの属性
3-2-1 aをインスタンス化してcにセット

4. IF P がnullでない || Pはnullであるが、Nがgomlのルートである(ルートでもなくPがnullなものは含まない(ただのデタッチされたツリー))
4-1. N.parent = P
4-2. Nのすべての属性の初期値を割り当て(GOMLの値 > Nodeの初期値 > Attributeの初期値　の優先度で割り当て)
4-3. SendMessage('awake') // <- 初のmountの前に呼び出される。どのコンポーネントに対しても必ず1回しか呼び出されない
4-4. SendMessage('mount') 

```

原則として、**マウントされていないコンポーネントはいかなる処理も呼び出されない**。これには属性の割り当ても含む。(コンストラクタを除く)
(属性の中にはtreeに属さなければ確定しない属性が存在しうるため(セレクタ指定など))

ただし、コンポーネントのコンストラクタに限り、コンポーネントの作者は仮にツリーにマウントされていない状態の処理をすることはできる。
(基本的にコンストラクタの使用は推奨されない)
